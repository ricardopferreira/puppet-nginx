#
# This file is managed by puppet class 'nginx'
#
# Main nginx configuration
#
user <%= @user %>;
worker_processes <%= @worker_processes %>;

error_log <%= @error_log %>;
pid /var/run/nginx.pid;

events {
  worker_connections <%= @worker_connections %>;
}

http {
  include /etc/nginx/mime.types;
  default_type application/octet-stream;

<%
if @proxy_cache_path
  @proxy_cache_path.each do |p_path|
-%>
  proxy_cache_path <%= p_path %>;
<%
  end
end
-%>
<%
if @fastcgi_cache_path
  @fastcgi_cache_path.each do |f_path|
-%>
  fastcgi_cache_path <%= f_path %>;
<%
  end
end
-%>
<% if @index -%>

  index <%= @index %>;

<% end -%>

  log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                  '$status $body_bytes_sent "$http_referer" '
                  '"$http_user_agent" "$http_x_forwarded_for"';

  access_log <%= @access_log %>;
  error_log <%= @error_log %>;

  sendfile on;
  keepalive_timeout <%= @keepalive_timeout %>;

  gzip <%= @gzip %>;

  include /etc/nginx/conf.d/*.conf;
  include <%= @vhost_dir %>/*.conf;
<%
if @include
  include.each do |incl| -%>
  include <%= incl %>;
<%
  end
end
-%>
}
